<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>dumbfi</title>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>
        <!-- <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script> -->
    </head>
    <body>
        <div id="chart"></div>
        <script>
            const data = [
                { date: "2024-01-01", AAPL: 50, IBM: 50 },
                { date: "2024-01-02", AAPL: 51, IBM: 49 },
            ];

            const width = 600;
            const height = 400;
            const margin = { top: 20, right: 30, left: 50, bottom: 30 };
            const innerWidth = width - margin.left - margin.right;
            const innerHeight = height - margin.top - margin.bottom;

            const svg = d3
                .select("#chart")
                .append("svg")
                .attr("width", width)
                .attr("height", height);

            const g = svg
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const stack = d3
                .stack()
                .keys(["AAPL", "IBM"])
                .order(d3.stackOrderNone)
                .offset(d3.stackOffsetNone);

            const series = stack(data);

            const x = d3
                .scaleBand()
                .domain(data.map((d) => d.date))
                .range([0, innerWidth])
                .padding(0.1);

            const y = d3.scaleLinear().domain([0, 100]).range([innerHeight, 0]);

            const color = d3
                .scaleOrdinal()
                .domain(["AAPL", "IBM"])
                .range(["#ff7300", "#00C49F"]);

            g.append("g")
                .attr("transform", `translate(0,${innerHeight})`)
                .call(d3.axisBottom(x));

            g.append("g").call(
                d3
                    .axisLeft(y)
                    .ticks(10)
                    .tickFormat((d) => d + "%"),
            );

            const groups = g
                .selectAll("g.series")
                .data(series)
                .join("g")
                .attr("class", "series")
                .attr("fill", (d) => color(d.key));

            const bars = groups
                .selectAll("rect")
                .data((d) => d)
                .join("rect")
                .attr("x", (d) => x(d.data.date))
                .attr("y", (d) => y(d[1]))
                .attr("height", (d) => y(d[0]) - y(d[1]))
                .attr("width", x.bandwidth());

            groups
                .selectAll("text")
                .data((d) => d)
                .join("text")
                .attr("x", (d) => x(d.data.date) + x.bandwidth() / 2)
                .attr("y", (d) => (y(d[0]) + y(d[1])) / 2)
                .attr("text-anchor", "middle")
                .attr("fill", "white")
                .text((d) => `${d.key} ${d.data[d.key]}%`);
        </script>
    </body>
</html>
